import VirtualAssistant from "../../components/virtualAssistant";
import Layout from "../layout";
import styles from "./malware.module.css";
import { useState, useRef, useEffect } from "react";

const MalwareInvasion = () => {
  const [points, setPoints] = useState(0);
  const [scenarioIndex, setScenarioIndex] = useState(0);
  const [scenarios, setScenarios] = useState([
    {
      background: "infected_website_bg.jpg",
      action: "List trusted websites and avoid untrusted ones",
      consequence: "Well done! Avoiding untrusted websites reduces the risk of malware infection.",
      points: 10,
    },
    {
      background: "malicious_downloads_bg.jpg",
      action: "Download software from reputable sources only",
      consequence: "Great decision! Downloading from reputable sources minimizes the risk of downloading malware.",
      points: 15,
    },
    // Add more scenarios, actions, and consequences as needed
  ]);

  const virtualAssistantRef = useRef();

  const handleActionClick = () => {
    const currentScenario = scenarios[scenarioIndex];
    setPoints((prevPoints) => prevPoints + currentScenario.points);

    if (virtualAssistantRef.current) {
      virtualAssistantRef.current.showAssistant(currentScenario.consequence);
    }

    // Move to the next scenario
    setScenarioIndex((prevIndex) => prevIndex + 1);
  };

  useEffect(() => {
    // Display initial scenario when the component mounts
    if (virtualAssistantRef.current && scenarios.length > 0) {
      virtualAssistantRef.current.showAssistant(
        "Welcome to the Malware Invasion simulation. Your decisions will determine your cybersecurity level."
      );
    }
  }, []);

  return (
    <Layout>
      <div className={styles.container}>
        {scenarioIndex < scenarios.length ? (
          <div className={styles.scenario}>
            <img
              src={`/images/${scenarios[scenarioIndex].background}`}
              alt={`Scenario ${scenarioIndex + 1}`}
              className={styles.backgroundImage}
            />
            <div className={styles.overlay}></div>
            <div className={styles.actionPanel}>
              <h3>Scenario {scenarioIndex + 1}</h3>
              <p>{scenarios[scenarioIndex].action}</p>
              <button className={styles.actionButton} onClick={handleActionClick}>
                Take Action
              </button>
            </div>
          </div>
        ) : (
          <div className={styles.completed}>
            <h3>Simulation Completed</h3>
            <p>Your cybersecurity level: {points} points</p>
          </div>
        )}
      </div>
      <VirtualAssistant ref={virtualAssistantRef} />
    </Layout>
  );
};

export default MalwareInvasion;
